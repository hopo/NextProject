<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- // 처방 매퍼 -->
<mapper
	namespace="kr.or.nextit.prescription.service.impl.PrescriptionMapper">

	<sql id="whereQuery">
		<if test="searchText != null and searchText != '' " >
			<if test="searchType == 'sel1'">
				and pre_code = #{pre_code}
			</if>	
			<if test="searchType == 'sel2'">
				and clnCode = #{clnCode}
			</if>	
			<if test="searchType== 'sel3'">
				and patCode = #{patCode}
			</if>	
			<if test="searchType== 'sel4'">
				and empId = #{empId}
			</if>	
		</if>
	</sql>





	<!-- 처방폼 화면  -->
	<select id="prescriptionSelect" parameterType="kr.or.nextit.comm.model.PrescriptionVo"
							   resultType="kr.or.nextit.comm.model.PrescriptionVo">

		 SELECT
		    prs_code,
		    cln_code,
		    prs_descr,
		    med_code,
		    med_code2,
		    med_code3
		FROM
		    tb_prescription

	</select>

	<!-- 진료테이블에서 진료코드로 가져오기  -->
	<select id="selectClinicItem" parameterType="HashMap" resultType="kr.or.nextit.comm.model.ClinicVo">
	
		SELECT
			cln_code ,
			pat_code ,
			emp_id ,
			cln_date ,
			cln_descr
		FROM
			tb_clinic
		WHERE
			cln_code=#{clnCode}
			
	</select>
	
	
	
	<!-- 처방등록   -->
	<insert id="insertPrescription" parameterType="kr.or.nextit.comm.model.PrescriptionVo" >

		 INSERT INTO tb_prescription (
		    prs_code,
		    cln_code,
		    prs_descr,
		    med_code,
		    med_code2,
		    med_code3
		 ) VALUES (
		    #{prsCode},
		    #{clnCode},
		    #{prsDescr},
		    #{medCode},
		    #{medCode2},
		    #{medCode3}
		)
	
	</insert>
	
	
	
	<!-- 처방 리스트   -->
	<select id="prescriptionSelectList" parameterType="kr.or.nextit.comm.util.SearchVo"
							   resultType="kr.or.nextit.comm.model.PrescriptionVo">
	select * from (
	select rownum as rnum, frm.* from(
		 SELECT
		    prs_code,
		    cln_code,
		    prs_descr,
		    med_code,
		    med_code2,
		    med_code3
		FROM
		    tb_prescription
		where 1=1
			<include refid="whereQuery"></include>
		order by prs_code DESC
	) frm 
) where rnum between #{startRow} and #{endRow}
</select>

	
	<!-- 처방 리스트 검색    -->
	<select id="selectTotalCount"  parameterType="kr.or.nextit.comm.model.PrescriptionVo" 
										resultType="int">
	select
		count(*) as totalCount
	from 
		tb_prescription
		where 1=1
			<include refid="whereQuery"></include>
	</select>
	
	
	
	
	
	
	
	<!-- 처방 수정 -->
	<!-- <update id="updatePrescription" parameterType="kr.or.nextit.comm.model.PrescriptionVo" >
		 
		 UPDATE tb_prescription
			SET
				prs_code =#{prsCode},
			    AND cln_code =#{clnCode},
			    AND prs_descr =#{prsDescr},
			    AND med_code =#{medCode},
			    AND med_code2 =#{medCode2},
			    AND med_code3 =#{medCode3}
			WHERE
				prs_code =#{prsCode}
	</update> -->









</mapper>




























